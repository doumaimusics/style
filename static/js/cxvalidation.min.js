/*!
 * cxValidation
 * @name cxvalidation.js
 * @version 0.8
 * @date 2017-07-06
 * @author ciaoca
 * @email ciaoca@gmail.com
 * @site https://github.com/ciaoca/cxValidation
 * @license Released under the MIT license
 */
!function(e,t){"use strict";var u={defaults:{complete:void 0,success:void 0,error:void 0},result:{status:!0},validMessage:{required:"",groupRequired:"至少填写 {{1}} 项",condRequired:"",equals:"两次输入的不一致",minSize:"最少 {{0}} 个字符",maxSize:"最多 {{0}} 个字符",min:"最小值为 {{0}}",max:"最大值为 {{0}}",integer:"无效的整数",number:"无效的数值",onlyNumber:"只能填写数字",onlyNumberSp:"只能填写数字和空格",onlyLetter:"只能填写英文字母",onlyLetterSp:"只能填写英文字母和空格",onlyLetterNumber:"只能填写英文字母与数字",onlyLetterNumberSp:"只能填写英文字母、数字、空格",email:"无效的邮件地址",phone:"无效的电话号码",url:"无效的网址",chinese:"只能填写中文汉字",chinaId:"无效的身份证号码",chinaIdLoose:"无效的身份证号码",chinaZip:"无效的邮政编码",qq:"无效的 QQ 号码"},isElement:function(e){return!(!e||"function"!=typeof HTMLElement&&"object"!=typeof HTMLElement||!(e instanceof HTMLElement))||!(!e||!e.nodeType||1!==e.nodeType)},isJquery:function(e){return!!(e&&e.length&&("function"==typeof jQuery||"object"==typeof jQuery)&&e instanceof jQuery)},isZepto:function(e){return!(!e||!e.length||"function"!=typeof Zepto&&"object"!=typeof Zepto||!Zepto.zepto.isZ(e))},isHidden:function(t){if(this.isElement(t)){var u=e.getComputedStyle(t);return"none"===u.getPropertyValue("display")||"hidden"===u.getPropertyValue("visibility")||0==u.getPropertyValue("opacity")||0==u.getPropertyValue("width")&&0==u.getPropertyValue("height")}return!0},isVisible:function(e){return!this.isHidden(e)},isAndroid:/android/i.test(navigator.userAgent)};u.validFun={required:function(e){return"checkbox"===e.type||"radio"===e.type?!!e.checked:!!e.value.trim().length},groupRequired:function(e,t,n){return t=String(t),n=parseInt(n,10),isNaN(n)&&(n=1),void 0!==u.groupCache[t]&&void 0!==u.groupCache[t].count||(u.groupCache[t]={count:n}),u.groupCache[t].count>0&&(u.validFun.required(e)?u.groupCache[t].count-=1:void 0===u.groupCache[t].element&&(u.groupCache[t].element=e)),!0},condRequired:function(e,t){var n=!1,r=!0;if(t.length){if(t=t.split(","),Array.isArray(t)&&t.length){n=!0;for(var o=0,a=t.length;o<a;o++)if(!u.validFun.required(document.getElementById(t[o]))){n=!1;break}}n&&(r=u.validFun.required(e))}return r},equals:function(e,t){return e.value==document.getElementById(t).value},minSize:function(e,t){return e.value.length&&e.value.length>=t},maxSize:function(e,t){return e.value.length&&e.value.length<=t},min:function(e,t){return e.value.length&&parseFloat(e.value)>=t},max:function(e,t){return e.value.length&&parseFloat(e.value)<=t},integer:function(e){return e.value.length&&/^[\-\+]?\d+$/.test(e.value)},number:function(e){return e.value.length&&/^[\-\+]?((([0-9]{1,3})([,][0-9]{3})*)|([0-9]+))?([\.]([0-9]+))?$/.test(e.value)},onlyNumber:function(e){return e.value.length&&/^[0-9]+$/.test(e.value)},onlyNumberSp:function(e){return e.value.length&&/^[0-9\ ]+$/.test(e.value)},onlyLetter:function(e){return e.value.length&&/^[a-zA-Z]+$/.test(e.value)},onlyLetterSp:function(e){return e.value.length&&/^[a-zA-Z\ ]+$/.test(e.value)},onlyLetterNumber:function(e){return e.value.length&&/^[0-9a-zA-Z]+$/.test(e.value)},onlyLetterNumberSp:function(e){return e.value.length&&/^[0-9a-zA-Z\ ]+$/.test(e.value)},email:function(e){return e.value.length&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(e.value)},phone:function(e){return e.value.length&&/^([\+][0-9]{1,3}[ \.\-])?([\(]{1}[0-9]{2,6}[\)])?([0-9 \.\-\/]{3,20})((x|ext|extension)[ ]?[0-9]{1,4})?$/.test(e.value)},url:function(e){return e.value.length&&/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e.value)},chinese:function(e){return e.value.length&&/^[\u4E00-\u9FA5]+$/.test(e.value)},chinaId:function(e){return e.value.length&&/^[1-9]\d{5}[1-9]\d{3}(((0[13578]|1[02])(0[1-9]|[12]\d|3[0-1]))|((0[469]|11)(0[1-9]|[12]\d|30))|(02(0[1-9]|[12]\d)))(\d{4}|\d{3}[xX])$/.test(e.value)},chinaIdLoose:function(e){return e.value.length&&/^(\d{18}|\d{15}|\d{17}[xX])$/.test(e.value)},chinaZip:function(e){return e.value.length&&/^\d{6}$/.test(e.value)},qq:function(e){return e.value.length&&/^[1-9]\d{4,10}$/.test(e.value)},call:function(){var t,u,n,r=Array.prototype.slice.call(arguments),o=r.splice(1,1);if(o.indexOf(".")>=0){for(t=o.split("."),u=e;t.length;)u=u[t.shift()];n=u}else n=e[o];return"function"!=typeof n||n.apply(u,r)}},u.init=function(){var e=this;e.groupCache={},e.vid=1,e.formFuns={},e.dom={},e.dom.tip=document.createElement("div"),e.dom.tip.classList.add("cxvalidation_tip"),document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(e.dom.tip)})},u.getRuleArguments=function(e,t){var u,n=e.dataset.validation,r=[],o=[];return"string"==typeof n&&n.length&&(r=n.replace(/\s|\[[^\]]*\]/g,"").split(",")),"string"==typeof t&&t.length&&r.indexOf(t)>=0&&(u=n.match(new RegExp(t+"((\\[[^\\]]+\\])+)")),Array.isArray(u)&&u.length>1&&(o=u[1].match(/([^\[\]]+)/g),Array.isArray(o)&&1===o.length&&"groupRequired"===t&&(o[1]=1))),o},u.getMessage=function(e,t){var u,n=this,r="";if("string"==typeof e.dataset.validationMessage&&e.dataset.validationMessage.length)try{r=JSON.parse(e.dataset.validationMessage),"string"==typeof r[t]&&r[t].length&&(r=r[t])}catch(t){r=e.dataset.validationMessage}else"string"==typeof n.validMessage[t]&&n.validMessage[t].length&&(r=n.validMessage[t]);u=n.getRuleArguments(e,t);for(var o=0,a=u.length;o<a;o++)r=r.replace(new RegExp("\\{\\{"+o+"\\}\\}"),u[o]);return r},u.validItem=function(e,t,u){var n,r,o,a=this,i=$.extend({},a.result),s=e.dataset.validation,F=[];if("function"==typeof t&&(t={success:t}),t=$.extend({},a.defaults,t),"function"==typeof u&&(t.error=u),"string"==typeof s&&s.length){F=s.replace(/\s|\[[^\]]*\]/g,"").split(",");for(var l=0,c=F.length;l<c;l++)if(o=F[l],"function"==typeof a.validFun[o]){n=s.match(new RegExp(o+"((\\[[^\\]]+\\])+)")),r=[e],Array.isArray(n)&&n.length>1&&(r=r.concat(n[1].match(/([^\[\]]+)/g)));var d=a.validFun[o].apply(a,r);if("boolean"==typeof d?i.status=d:$.isPlainObject(i)&&"boolean"==typeof d.status&&(i=d),!1===i.status){i.rule=o,"string"==typeof i.message&&i.message.length||(i.message=a.getMessage(e,o));break}}}return i.element=e,"function"==typeof t.complete&&t.complete(i),!0===i.status&&"function"==typeof t.success?t.success(i):!1===i.status&&"function"==typeof t.error&&t.error(i),"object"===t.type?i:i.status},u.validForm=function(e,t,u){var n=this,r=$.extend({},n.result);"function"==typeof t&&(t={success:t}),t=$.extend({},n.defaults,t),"function"==typeof u&&(t.error=u),n.groupCache={};var o=[].concat(Array.prototype.slice.call(e.querySelectorAll("input")),Array.prototype.slice.call(e.querySelectorAll("textarea")),Array.prototype.slice.call(e.querySelectorAll("select")));if($.each(o,function(e,t){var u=n.validItem(t,{type:"object"});if($.isPlainObject(u)&&!1===u.status)return r.element=t,r.status=!1,"string"==typeof u.rule&&u.rule.length&&(r.rule=u.rule),"string"==typeof u.message&&u.message.length&&(r.message=u.message),!1}),!0===r.status)for(var a in n.groupCache)if(n.groupCache[a].count>0){r.status=!1,r.rule="groupRequired",r.element=n.groupCache[a].element,r.message=n.getMessage(r.element,r.rule);break}return n.groupCache={},r.form=e,"function"==typeof t.complete&&t.complete(r),!0===r.status&&"function"==typeof t.success?t.success(r):!1===r.status&&"function"==typeof t.error&&t.error(r),"object"===t.type?r:r.status},u.formSubmitFn=function(e,t){event.preventDefault();var u=this,n={type:"object",success:function(t){e.submit()},error:function(e){var t=e.element.nodeName.toLowerCase();"string"==typeof e.message&&e.message.length?u.isAndroid&&"select"===t?u.toMessage(e.element,e.message):u.toMessage(e.element,e.message,function(){u.toFocus(e.element)}):(u.dom.tip.classList.remove("show"),u.isAndroid&&"select"===t?u.toMessage(e.element):u.toFocus(e.element))}};t=$.extend({},n,t),u.validForm(e,t)},u.toMessage=function(e,t,u){var n=this;e.nodeName.toLowerCase();"string"==typeof t&&t.length||(t="表单验证未通过"),"function"!=typeof u&&(u=function(){}),"function"==typeof $.cxDialog?$.cxDialog({title:"提示",info:t,ok:u}):(void 0!==n.closeTipWait&&clearTimeout(n.closeTipWait),n.dom.tip.innerHTML=t,n.dom.tip.classList.add("show"),u(),n.closeTipWait=setTimeout(function(){n.dom.tip.classList.remove("show")},3e3))},u.toFocus=function(e){var t=this,u=e.nodeName.toLowerCase();t.isVisible(e)&&(t.isAndroid?"select"===u&&t.toMessage(e):e.focus())},u.init();var n=function(){return n.valid.apply(n,arguments)};n.valid=function(){for(var e,t={},n=0,r=arguments.length;n<r;n++)u.isElement(arguments[n])?e=arguments[n]:u.isJquery(arguments[n])||u.isZepto(arguments[n])?e=arguments[n][0]:"function"==typeof arguments[n]?"function"==typeof t.success?t.error=arguments[n]:t.success=arguments[n]:"object"==typeof arguments[n]&&(t=$.extend(t,arguments[n]));if(u.isElement(e)){var o=e.nodeName.toLowerCase();return"input"===o||"select"===o||"textarea"===o?u.validItem(e,t):u.validForm(e,t)}},n.attach=function(e,t){for(var n,r={},o=0,a=arguments.length;o<a;o++)u.isJquery(arguments[o])||u.isZepto(arguments[o])||u.isElement(arguments[o])?n=u.isJquery(arguments[o])||u.isZepto(arguments[o])?arguments[o][0]:arguments[o]:"function"==typeof arguments[o]?"function"==typeof r.success?r.error=arguments[o]:r.success=arguments[o]:"object"==typeof arguments[o]&&(r=$.extend(r,arguments[o]));if(!u.isElement(n)||!n.nodeName||"form"!==n.nodeName.toLowerCase())return!1;var i=n.dataset.cxVid;return"function"!=typeof u.formFuns[i]?(i="cxValid_"+u.vid,n.dataset.cxVid=i,u.vid++):e.removeEventListener("submit",u.formFuns[i]),u.formFuns[i]=u.formSubmitFn.bind(u,n,r),n.addEventListener("submit",u.formFuns[i]),!0},n.detach=function(e){if((u.isJquery(e)||u.isZepto(e))&&(e=e[0]),!u.isElement(e)||!e.nodeName||"form"!==e.nodeName.toLowerCase())return!1;var t=e.dataset.cxVid;return"function"==typeof u.formFuns[t]&&(e.removeEventListener("submit",u.formFuns[t]),!0)},$.cxValidation=e.cxValidation=n}(window);